<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concierge Legal Chatbot Builder | AI Assistant for Law Firms</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 50%, #1d4ed8 100%);
        }
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .custom-input, .custom-select {
            transition: all 0.2s ease-in-out;
        }
        .custom-input:focus, .custom-select:focus {
            box-shadow: 0 0 0 2px #3b82f6;
            border-color: #3b82f6;
        }
        .custom-checkbox:checked {
            background-color: #2563eb;
            border-color: #2563eb;
        }
        .custom-radio:checked {
             border-color: #2563eb;
        }
        .custom-radio:checked::after {
            background-color: #2563eb;
        }
        .color-picker {
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            width: 40px; height: 40px;
            border: none; cursor: pointer;
            border-radius: 50%;
            transition: transform 0.2s;
        }
        .color-picker:hover {
            transform: scale(1.1);
        }
        .color-picker::-webkit-color-swatch {
            border-radius: 50%; border: 2px solid #e5e7eb;
        }
        .color-picker::-moz-color-swatch {
            border-radius: 50%; border: 2px solid #e5e7eb;
        }
        .modal-backdrop {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(4px);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000;
            opacity: 0; visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-backdrop.active {
            opacity: 1; visibility: visible;
        }
        .modal-content {
            background-color: white; padding: 2rem; border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
            width: 90%; max-width: 420px; text-align: center;
            transform: scale(0.95) translateY(10px);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .modal-backdrop.active .modal-content {
            transform: scale(1) translateY(0);
        }

        /* Demo Chatbot Styles */
        .demo-modal .chat-container {
            width: 100%;
            max-width: 450px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        .demo-modal .chat-header {
            background: linear-gradient(135deg, #1a2a44 0%, #2d3748 100%);
            color: white; padding: 20px; text-align: center;
        }
        .demo-modal .chat-header h3 { margin: 0; font-size: 1.2em; font-weight: 600; }
        .demo-modal .chat-header p { margin: 5px 0 0; opacity: 0.9; font-size: 0.9em; }
        .demo-modal .chat-messages { height: 500px; overflow-y: auto; padding: 20px; background: #f8f9fa; }
        .demo-modal .message { margin-bottom: 15px; opacity: 0; animation: fadeIn 0.5s ease-in forwards; }
        .demo-modal .bot-message { display: flex; align-items: flex-start; gap: 10px; }
        .demo-modal .bot-avatar {
            width: 35px; height: 35px;
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; font-size: 14px; flex-shrink: 0;
        }
        .demo-modal .bot-text { background: white; padding: 12px 16px; border-radius: 18px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); max-width: 85%; line-height: 1.4; }
        .demo-modal .user-message { display: flex; justify-content: flex-end; }
        .demo-modal .user-text { background: linear-gradient(135deg, #1a2a44 0%, #2d3748 100%); color: white; padding: 12px 16px; border-radius: 18px; max-width: 85%; line-height: 1.4; }
        .demo-modal .options { display: flex; flex-direction: column; gap: 8px; margin-top: 12px; }
        .demo-modal .option-btn { background: white; border: 2px solid #e2e8f0; padding: 12px 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; text-align: left; font-size: 14px; }
        .demo-modal .option-btn:hover { border-color: #d4af37; background: #fefcf0; transform: translateY(-1px); }
        .demo-modal .typing-indicator { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .demo-modal .typing-dots { display: flex; gap: 4px; background: white; padding: 12px 16px; border-radius: 18px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .demo-modal .dot { width: 8px; height: 8px; background: #cbd5e0; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out; }
        .demo-modal .dot:nth-child(1) { animation-delay: -0.32s; }
        .demo-modal .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .demo-modal .highlight { background: linear-gradient(120deg, #d4af37 0%, #f4d03f 100%); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 600; }
        .demo-modal .demo-note { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin: 15px 20px; font-size: 0.85em; color: #856404; }
        .demo-modal .demo-note strong { color: #1a2a44; }
        .demo-modal .payment-section { background: #f8f9ff; border: 2px solid #e6f3ff; border-radius: 8px; padding: 15px; margin-top: 12px; }
        .demo-modal .payment-amount { font-size: 1.2em; font-weight: bold; color: #1a2a44; margin-bottom: 10px; }
        .demo-modal .stripe-btn { background: linear-gradient(135deg, #635bff 0%, #5469d4 100%); color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; width: 100%; transition: transform 0.2s ease; }
        .demo-modal .stripe-btn:hover { transform: translateY(-1px); }
        .demo-modal-close-btn { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.3); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        .spinner {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="font-sans bg-gray-100">
    <div class="min-h-screen flex flex-col lg:flex-row">
        <!-- Left Panel - Sales Content -->
        <div class="lg:w-1/2 gradient-bg text-white p-8 lg:p-12 flex flex-col justify-center">
            <header class="mb-12">
                 <div class="flex items-center text-2xl font-bold mb-4">
                    <i class="fas fa-gavel mr-3"></i>
                    <span>Concierge Legal</span>
                </div>
                <h1 class="text-4xl lg:text-5xl font-bold mb-3 leading-tight">Stop Missing New Clients.</h1>
                <p class="text-lg lg:text-xl opacity-80">Our AI chatbot qualifies leads and books consultations on your website, 24/7. Turn visitors into clients, even while you sleep.</p>
            </header>

            <div class="space-y-8 my-auto">
                <div class="flex items-start">
                    <div class="bg-white bg-opacity-10 rounded-xl p-3 mr-5 flex-shrink-0">
                        <i class="fas fa-clock text-white text-2xl w-8 text-center"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg">24/7 Lead Capture</h3>
                        <p class="opacity-80">Never lose a potential client to your office's voicemail again. Our AI is always on, ready to engage.</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <div class="bg-white bg-opacity-10 rounded-xl p-3 mr-5 flex-shrink-0">
                        <i class="fas fa-chart-line text-white text-2xl w-8 text-center"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg">2-3x More Conversions</h3>
                        <p class="opacity-80">Firms using our chatbot see a 150-200% increase in qualified leads from their existing website traffic.</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <div class="bg-white bg-opacity-10 rounded-xl p-3 mr-5 flex-shrink-0">
                        <i class="fas fa-shield-alt text-white text-2xl w-8 text-center"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg">Ethical & Compliant</h3>
                        <p class="opacity-80">Built for the legal industry with required disclaimers and a focus on professional, compliant interactions.</p>
                    </div>
                </div>
            </div>
             <div class="mt-12">
                <button id="open-demo-btn" class="w-full bg-white text-blue-700 font-bold text-lg py-4 rounded-lg shadow-lg hover:bg-gray-200 transition-all duration-200 transform hover:-translate-y-1">
                    <i class="fas fa-comment-dots mr-3"></i>
                    Try a Live Demo
                </button>
            </div>
        </div>

        <!-- Right Panel - Builder Wizard -->
        <div class="lg:w-1/2 bg-white p-8 lg:p-12 flex items-center">
            <div class="max-w-2xl w-full mx-auto">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-800">Build Your Custom Chatbot</h2>
                    <p class="text-gray-500 mt-1">Get a personalized proposal in minutes.</p>
                </div>
                
                <!-- Progress Bar -->
                <div class="flex items-center mb-8">
                    <div id="progress-bar-text" class="text-sm font-medium text-gray-600 mr-4">Step 1: Firm Info</div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>


                <!-- Form Steps -->
                <form id="chatbot-builder" class="space-y-6" action="https://formspree.io/f/mdkzbqgo" method="POST">
                    <!-- Step 1: Contact & Service Area -->
                    <div class="form-step active" data-step="1" data-step-name="Firm Info">
                        <h3 class="text-xl font-semibold mb-6 text-gray-800">About Your Firm</h3>
                        <div class="space-y-4">
                            <input type="text" id="firm-name" name="firm-name" required placeholder="Law Firm Name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none custom-input">
                            <input type="text" id="full-name" name="full-name" required placeholder="Your Full Name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none custom-input">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <input type="email" id="email" name="email" required placeholder="Email Address" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none custom-input">
                                <input type="tel" id="phone" name="phone" required placeholder="Phone Number" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none custom-input">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <input type="text" id="zip-code" name="zip-code" required placeholder="Service Area Zip Code" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none custom-input">
                                <select id="service-radius" name="service-radius" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none custom-select bg-white">
                                    <option value="" disabled selected>Service Radius</option>
                                    <option value="10">10 miles</option>
                                    <option value="25">25 miles</option>
                                    <option value="50">50 miles</option>
                                    <option value="100">100 miles</option>
                                    <option value="state">Entire State</option>
                                    <option value="national">National</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Practice Area Focus -->
                    <div class="form-step" data-step="2" data-step-name="Practice Areas">
                        <h3 class="text-xl font-semibold mb-6 text-gray-800">Practice Areas</h3>
                        <div class="space-y-6">
                            <label class="block text-sm font-medium text-gray-700">Main Practice Areas (select all that apply)</label>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                                <!-- Checkboxes will be populated here -->
                            </div>
                            <div id="sub-practice-container" class="hidden pt-4 border-t">
                                <label class="block text-sm font-medium text-gray-700 mb-4">Sub-Practice Areas (select all that apply)</label>
                                <div id="sub-practice-areas" class="grid grid-cols-2 sm:grid-cols-3 gap-4"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Goals & Performance -->
                    <div class="form-step" data-step="3" data-step-name="Goals">
                        <h3 class="text-xl font-semibold mb-6 text-gray-800">Your Goals</h3>
                        <div class="space-y-6">
                            <label class="block text-sm font-medium text-gray-700">Primary Conversion Goal</label>
                            <div id="goal-options" class="grid grid-cols-2 gap-4"></div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t">
                                <select id="monthly-visitors" name="monthly-visitors" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none custom-select bg-white">
                                     <option value="" disabled selected>Monthly Website Visitors</option>
                                     <option value="0-500">0-500</option>
                                     <option value="500-1000">500-1,000</option>
                                     <option value="1000-2500">1,000-2,500</option>
                                     <option value="2500-5000">2,500-5,000</option>
                                     <option value="5000+">5,000+</option>
                                </select>
                                <select id="conversion-rate" name="conversion-rate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none custom-select bg-white">
                                    <option value="" disabled selected>Current Conversion Rate</option>
                                    <option value="0-1%">0-1%</option>
                                    <option value="1-2%">1-2%</option>
                                    <option value="2-3%">2-3%</option>
                                    <option value="3-5%">3-5%</option>
                                    <option value="5%+">5%+</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Branding & Style -->
                    <div class="form-step" data-step="4" data-step-name="Branding">
                         <h3 class="text-xl font-semibold mb-6 text-gray-800">Branding & Style</h3>
                         <div class="space-y-8">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">Chatbot Tone</label>
                                <div id="tone-options" class="grid grid-cols-2 gap-4"></div>
                            </div>
                             <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">Brand Colors</label>
                                <div class="flex items-center space-x-6">
                                    <div class="text-center"><label class="block text-xs text-gray-500 mb-1">Primary</label><input type="color" id="primary-color" name="primary-color" value="#3b82f6" class="color-picker"></div>
                                    <div class="text-center"><label class="block text-xs text-gray-500 mb-1">Secondary</label><input type="color" id="secondary-color" name="secondary-color" value="#1d4ed8" class="color-picker"></div>
                                    <div class="text-center"><label class="block text-xs text-gray-500 mb-1">Text</label><input type="color" id="text-color" name="text-color" value="#1f2937" class="color-picker"></div>
                                    <div class="text-center"><label class="block text-xs text-gray-500 mb-1">Background</label><input type="color" id="bg-color" name="bg-color" value="#ffffff" class="color-picker"></div>
                                </div>
                            </div>
                         </div>
                    </div>

                    <!-- Step 5: Features & Enhancements -->
                    <div class="form-step" data-step="5" data-step-name="Features">
                        <h3 class="text-xl font-semibold mb-6 text-gray-800">Features & Enhancements</h3>
                        <div class="space-y-8">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">Languages</label>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <label class="flex items-center p-4 border rounded-lg cursor-pointer"><input type="radio" name="languages" value="english" class="custom-radio h-5 w-5 mr-3" checked> English Only</label>
                                    <label class="flex items-center p-4 border rounded-lg cursor-pointer"><input type="radio" name="languages" value="english-spanish" class="custom-radio h-5 w-5 mr-3"> English + Spanish</label>
                                </div>
                                <div class="mt-4">
                                     <label class="flex items-center p-4 border rounded-lg cursor-pointer"><input type="radio" name="languages" value="other" class="custom-radio h-5 w-5 mr-3"> Other</label>
                                     <div id="other-lang-container" class="mt-2 hidden">
                                        <input type="text" id="other-lang" name="other-lang" placeholder="Which languages?" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none custom-input">
                                     </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">Additional Features</label>
                                <div id="features-options" class="space-y-4"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Step 6: Technical & Compliance -->
                     <div class="form-step" data-step="6" data-step-name="Compliance">
                        <h3 class="text-xl font-semibold mb-6 text-gray-800">Technical & Compliance</h3>
                        <div class="space-y-6">
                             <div>
                                <label for="client-email" class="block text-sm font-medium text-gray-700 mb-1">Email to Receive Client Info</label>
                                <input type="email" id="client-email" name="client-email" required placeholder="e.g., intake@yourfirm.com" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none custom-input">
                            </div>
                            <div>
                                <label for="legal-disclaimer" class="block text-sm font-medium text-gray-700 mb-1">Legal Disclaimer Style</label>
                                <select id="legal-disclaimer" name="legal-disclaimer" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none custom-select bg-white">
                                    <option value="standard">Standard Disclaimer</option>
                                    <option value="strong">Stronger Disclaimer</option>
                                    <option value="friendly">Friendly Disclaimer</option>
                                    <option value="custom">Custom (provide below)</option>
                                </select>
                                <div id="custom-disclaimer-container" class="mt-2 hidden">
                                    <textarea id="custom-disclaimer" name="custom-disclaimer" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Paste your custom disclaimer text"></textarea>
                                </div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="consultation-fee" class="block text-sm font-medium text-gray-700 mb-1">Typical Consultation Fee ($)</label>
                                    <input type="number" id="consultation-fee" name="consultation-fee" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none custom-input" placeholder="e.g., 250">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Need HIPAA-Safe Setup?</label>
                                    <div class="flex items-center space-x-4 h-full">
                                        <label class="flex items-center"><input type="radio" id="hipaa-no" name="hipaa" value="no" class="custom-radio h-5 w-5 mr-2" checked>No</label>
                                        <label class="flex items-center"><input type="radio" id="hipaa-yes" name="hipaa" value="yes" class="custom-radio h-5 w-5 mr-2">Yes (+$99/mo)</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Confirmation Step -->
                    <div class="form-step" data-step="7" data-step-name="Proposal">
                        <div id="proposal-calculating" class="text-center py-12">
                             <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4">
                                <i class="fas fa-spinner spinner text-blue-600 text-2xl"></i>
                            </div>
                            <h3 class="text-xl font-semibold mb-2 text-gray-800">Calculating your custom solution...</h3>
                            <p class="text-gray-500">Personalizing your proposal based on your selections.</p>
                        </div>
                        <div id="proposal-content" class="hidden">
                            <div class="text-center py-4">
                                <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4">
                                    <i class="fas fa-check text-green-600 text-2xl"></i>
                                </div>
                                <h3 class="text-2xl font-semibold mb-2 text-gray-800">Your Custom Proposal is Ready!</h3>
                                <p class="text-gray-600 mb-8">Here is the value your new AI assistant can bring to your practice.</p>
                            </div>
                            <div id="summary-details" class="space-y-6 text-left">
                                <!-- Summary will be populated here -->
                            </div>
                        </div>
                    </div>
                </form>

                <!-- Navigation Buttons -->
                <div class="mt-10 flex items-center">
                    <button id="prev-btn" class="px-6 py-3 text-gray-600 font-medium hover:text-gray-900 transition opacity-0 invisible">
                        <i class="fas fa-arrow-left mr-2"></i> Back
                    </button>
                    <button id="next-btn" class="ml-auto px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                        Continue <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                    <button id="submit-btn" class="hidden w-full px-8 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-semibold text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                        <i class="fas fa-lock mr-2"></i> Finalize & Proceed to Payment
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Form Modal -->
    <div id="custom-modal" class="modal-backdrop">
        <div class="modal-content">
             <div id="modal-icon" class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
            </div>
            <h3 id="modal-title" class="text-lg font-medium text-gray-900 mb-2">Validation Error</h3>
            <p id="modal-message" class="mb-6 text-sm text-gray-600"></p>
            <button id="modal-close-btn" class="w-full px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                OK
            </button>
        </div>
    </div>
    
    <!-- Demo Chatbot Modal -->
    <div id="demo-modal" class="modal-backdrop demo-modal">
        <div class="chat-container relative">
            <button id="demo-modal-close-btn" class="demo-modal-close-btn">&times;</button>
            <div class="chat-header">
                <h3>Smith & Associates Law</h3>
                <p>Free Legal Consultation Assistant</p>
            </div>
            <div class="demo-note">
                <strong>Demo Features:</strong> ✓ Lead qualification ✓ Deposit collection ✓ Appointment scheduling
            </div>
            <div class="chat-messages" id="demo-messages">
                 <!-- Demo messages will be injected here -->
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- CONFIGURATION ---
            const formConfig = {
                practiceAreas: {
                    'Personal Injury': { icon: 'fa-user-injured', subs: ['Car Accidents', 'Slip & Fall', 'Medical Malpractice', 'Workplace Injury', 'Wrongful Death'] },
                    'Family Law': { icon: 'fa-users', subs: ['Divorce', 'Child Custody', 'Adoption', 'Prenuptial Agreements', 'Alimony'] },
                    'Criminal Defense': { icon: 'fa-handcuffs', subs: ['DUI', 'Drug Charges', 'Theft', 'Assault', 'White Collar'] },
                    'Real Estate': { icon: 'fa-house-user', subs: ['Residential', 'Commercial', 'Landlord/Tenant', 'Zoning', 'Title Disputes'] },
                    'Employment Law': { icon: 'fa-briefcase', subs: ['Discrimination', 'Wrongful Termination', 'Wage & Hour', 'Harassment', 'Contract Review'] },
                    'Business Law': { icon: 'fa-building', subs: ['Formation', 'Contracts', 'Mergers', 'Compliance', 'Disputes'] }
                },
                goals: {
                    'Schedule Consultation': 'fa-calendar-check',
                    'Phone Call': 'fa-phone',
                    'In-Office Appointment': 'fa-building-user',
                    'Complete Intake Form': 'fa-file-signature',
                    'Download Guide': 'fa-file-arrow-down'
                },
                tones: {
                    'Formal & Professional': 'fa-user-tie',
                    'Friendly & Approachable': 'fa-handshake',
                    'Empathetic & Supportive': 'fa-heart',
                    'Assertive & Direct': 'fa-gavel'
                },
                features: {
                    'Weekly Analytics Reports (+$49/mo)': { value: 'analytics', checked: true },
                    '24/7 Live Chat Handoff (+$199/mo)': { value: '24hr', checked: false },
                    'Document Collection (+$99/mo)': { value: 'document', checked: false },
                    'Retainer Collection (+$79/mo)': { value: 'payment', checked: false }
                }
            };

            // --- UI ELEMENT GENERATION ---
            function populateOptions() {
                const practiceAreaContainer = document.querySelector('[data-step="2"] .grid');
                const goalContainer = document.getElementById('goal-options');
                const toneContainer = document.getElementById('tone-options');
                const featuresContainer = document.getElementById('features-options');

                for (const [area, data] of Object.entries(formConfig.practiceAreas)) {
                    practiceAreaContainer.innerHTML += `
                        <label class="flex flex-col items-center justify-center text-center p-4 border rounded-lg cursor-pointer hover:border-blue-500 transition-all duration-200">
                            <input type="checkbox" name="practice-areas[]" value="${area}" class="hidden">
                            <i class="fas ${data.icon} text-2xl mb-2 text-gray-500"></i>
                            <span class="text-sm font-medium text-gray-700">${area}</span>
                        </label>`;
                }

                for (const [goal, icon] of Object.entries(formConfig.goals)) {
                    goalContainer.innerHTML += `
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer">
                            <input type="radio" name="conversion-goal" value="${goal}" class="custom-radio h-5 w-5 mr-3">
                            <i class="fas ${icon} mr-3 text-gray-500"></i>
                            <span>${goal}</span>
                        </label>`;
                }
                
                for (const [tone, icon] of Object.entries(formConfig.tones)) {
                    toneContainer.innerHTML += `
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer">
                            <input type="radio" name="tone" value="${tone}" class="custom-radio h-5 w-5 mr-3">
                            <i class="fas ${icon} mr-3 text-gray-500"></i>
                            <span>${tone}</span>
                        </label>`;
                }
                
                 for (const [feature, data] of Object.entries(formConfig.features)) {
                    featuresContainer.innerHTML += `
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer">
                            <input type="checkbox" name="features[]" value="${data.value}" class="custom-checkbox h-5 w-5 mr-4 rounded" ${data.checked ? 'checked' : ''}>
                            <span>${feature}</span>
                        </label>`;
                }

                // Add event listeners for new custom radios/checkboxes
                document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(el => {
                    el.addEventListener('change', (e) => {
                        const parentLabel = e.target.closest('label');
                        if (!parentLabel) return;
                        
                        if (e.target.type === 'radio') {
                            document.querySelectorAll(`input[name="${e.target.name}"]`).forEach(radio => {
                                radio.closest('label').classList.remove('border-blue-500', 'bg-blue-50');
                            });
                        }
                        
                        if (e.target.checked) {
                            parentLabel.classList.add('border-blue-500', 'bg-blue-50');
                        } else {
                            parentLabel.classList.remove('border-blue-500', 'bg-blue-50');
                        }

                        if(e.target.name === 'practice-areas[]') {
                            toggleSubPracticeAreas();
                        }
                    });
                });
            }
            populateOptions();

            // --- STATE MANAGEMENT ---
            let currentStep = 1;
            const formSteps = document.querySelectorAll('.form-step');
            const totalSteps = formSteps.length;

            // --- DOM ELEMENTS ---
            const form = document.getElementById('chatbot-builder');
            const nextBtn = document.getElementById('next-btn');
            const prevBtn = document.getElementById('prev-btn');
            const submitBtn = document.getElementById('submit-btn');
            const progressBar = document.getElementById('progress-bar');
            const progressBarText = document.getElementById('progress-bar-text');
            
            // Main Modal
            const modal = document.getElementById('custom-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalIcon = document.getElementById('modal-icon');
            const modalCloseBtn = document.getElementById('modal-close-btn');

            // Demo Modal
            const openDemoBtn = document.getElementById('open-demo-btn');
            const demoModal = document.getElementById('demo-modal');
            const demoModalCloseBtn = document.getElementById('demo-modal-close-btn');

            // --- EVENT LISTENERS ---
            nextBtn.addEventListener('click', () => navigateToStep(currentStep + 1));
            prevBtn.addEventListener('click', () => navigateToStep(currentStep - 1));
            
            // Handle form submission
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                const formSpreeUrl = 'https://formspree.io/f/mdkzbqgo';
                const stripeUrl = 'https://buy.stripe.com/fZu28q94hc6ke4n22hbbG08';

                showBuilderModal('Submitting...', 'Sending your proposal details.', 'loading');

                try {
                    const response = await fetch(formSpreeUrl, {
                        method: 'POST',
                        body: new FormData(this),
                        headers: {
                            'Accept': 'application/json'
                        }
                    });

                    if (response.ok) {
                        showBuilderModal('Success!', 'Your proposal is on its way. You will now be redirected to finalize your setup.', 'success');
                        setTimeout(() => {
                            window.location.href = stripeUrl;
                        }, 2000);
                    } else {
                        throw new Error('Form submission failed.');
                    }
                } catch (error) {
                    showBuilderModal('Error', 'There was a problem submitting your request. Please try again.', 'error');
                }
            });
            
            submitBtn.addEventListener('click', () => form.requestSubmit());

            modalCloseBtn.addEventListener('click', closeBuilderModal);
            modal.addEventListener('click', (e) => e.target === modal && closeBuilderModal());
            
            openDemoBtn.addEventListener('click', openDemoModal);
            demoModalCloseBtn.addEventListener('click', closeDemoModal);
            demoModal.addEventListener('click', (e) => e.target === demoModal && closeDemoModal());

            document.querySelectorAll('input[name="languages"]').forEach(radio => {
                radio.addEventListener('change', () => document.getElementById('other-lang-container').classList.toggle('hidden', document.querySelector('input[name="languages"]:checked').value !== 'other'));
            });
            document.getElementById('legal-disclaimer').addEventListener('change', function() {
                document.getElementById('custom-disclaimer-container').classList.toggle('hidden', this.value !== 'custom');
            });

            // --- FUNCTIONS ---
            function navigateToStep(step) {
                if (step > currentStep && !validateStep(currentStep)) return;
                
                if (step >= 1 && step <= totalSteps) {
                    currentStep = step;
                    if (currentStep === totalSteps) {
                        generateSummary();
                    }
                    updateUI();
                }
            }

            function updateUI() {
                formSteps.forEach(stepEl => {
                    stepEl.classList.toggle('active', parseInt(stepEl.dataset.step) === currentStep);
                });

                const activeStepEl = document.querySelector(`.form-step[data-step="${currentStep}"]`);
                const stepName = activeStepEl.dataset.stepName;
                const progressPercentage = ((currentStep - 1) / (totalSteps - 1)) * 100;
                
                progressBar.style.width = `${progressPercentage}%`;
                progressBarText.textContent = `Step ${currentStep}: ${stepName}`;

                prevBtn.classList.toggle('opacity-0', currentStep === 1);
                prevBtn.classList.toggle('invisible', currentStep === 1);
                nextBtn.classList.toggle('hidden', currentStep === totalSteps);
                submitBtn.classList.toggle('hidden', currentStep !== totalSteps);
            }

            function validateStep(step) {
                const stepEl = document.querySelector(`.form-step[data-step="${step}"]`);
                const requiredInputs = stepEl.querySelectorAll('[required]');
                
                for (const input of requiredInputs) {
                    if (!input.value.trim()) {
                        showBuilderModal('Validation Error', `Please fill in all required fields.`, 'error');
                        input.focus();
                        input.classList.add('border-red-500');
                        return false;
                    }
                    if (input.type === 'email' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value)) {
                        showBuilderModal('Validation Error', 'Please enter a valid email address.', 'error');
                        input.focus();
                        input.classList.add('border-red-500');
                        return false;
                    }
                    input.classList.remove('border-red-500');
                }

                if (step === 2 && stepEl.querySelectorAll('input[name="practice-areas[]"]:checked').length === 0) {
                    showBuilderModal('Validation Error', 'Please select at least one practice area.', 'error');
                    return false;
                }
                return true;
            }

            function toggleSubPracticeAreas() {
                const checkedAreas = Array.from(document.querySelectorAll('input[name="practice-areas[]"]:checked')).map(el => el.value);
                const container = document.getElementById('sub-practice-container');
                const subPracticeDiv = document.getElementById('sub-practice-areas');
                subPracticeDiv.innerHTML = '';
                
                let hasSubPractices = false;
                checkedAreas.forEach(area => {
                    const subs = formConfig.practiceAreas[area]?.subs;
                    if (subs) {
                        hasSubPractices = true;
                        subs.forEach(subArea => {
                            subPracticeDiv.innerHTML += `
                                <label class="flex items-center p-3 border rounded-lg cursor-pointer text-sm">
                                    <input type="checkbox" name="sub-practice-areas[]" value="${subArea}" class="custom-checkbox h-4 w-4 mr-3 rounded">
                                    ${subArea}
                                </label>`;
                        });
                    }
                });
                container.classList.toggle('hidden', !hasSubPractices);
                 // Re-add event listeners for the new checkboxes
                subPracticeDiv.querySelectorAll('input[type="checkbox"]').forEach(el => {
                    el.addEventListener('change', (e) => {
                         e.target.closest('label').classList.toggle('border-blue-500', e.target.checked);
                         e.target.closest('label').classList.toggle('bg-blue-50', e.target.checked);
                    });
                });
            }

            function generateSummary() {
                const calculatingDiv = document.getElementById('proposal-calculating');
                const contentDiv = document.getElementById('proposal-content');
                calculatingDiv.style.display = 'block';
                contentDiv.style.display = 'none';

                setTimeout(() => {
                    const summaryDiv = document.getElementById('summary-details');
                    const formData = new FormData(document.getElementById('chatbot-builder'));
                    const data = Object.fromEntries(formData.entries());

                    const createSummaryCard = (title, content, icon, color) => `
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <h4 class="font-semibold text-lg mb-4 text-gray-800 flex items-center">
                                <i class="fas ${icon} text-${color}-500 mr-3"></i>
                                ${title}
                            </h4>
                            <div class="space-y-3 text-sm text-gray-600">${content}</div>
                        </div>`;

                    const features = formData.getAll('features[]').map(val => {
                        return Object.keys(formConfig.features).find(key => formConfig.features[key].value === val);
                    }).join('<br>');
                    
                    const summaryContent = `
                        <p><strong>Practice Areas:</strong> ${formData.getAll('practice-areas[]').join(', ')}</p>
                        <p><strong>Chatbot Tone:</strong> ${data.tone}</p>
                        <p class="pt-2 border-t mt-2"><strong>Add-ons:</strong><br>${features || 'None'}</p>`;
                    
                    const timeSavingsContent = `<p class="text-lg">This will save you approximately <strong class="text-green-600">8-12 hours</strong> per week of administrative work and follow-ups.</p>`;

                    const consultationFee = parseFloat(data['consultation-fee']) || 250;
                    const clientsToBreakEven = Math.ceil((750 + 150) / consultationFee);
                    const roiContent = `<p class="text-lg">Based on your consultation fee, this platform pays for itself with just <strong class="text-green-600">${clientsToBreakEven} extra clients</strong> per month.</p>`;

                    const pricingContent = `
                        <div class="flex justify-between items-center">
                            <p>Investment in your practice growth:</p>
                            <p class="font-bold text-lg">$750 setup</p>
                        </div>
                        <div class="flex justify-between items-center border-t pt-3 mt-3">
                            <p>Ongoing optimization & hosting:</p>
                            <p class="font-bold text-lg">$150 / month</p>
                        </div>
                        <p class="text-xs text-center mt-4 text-gray-500">ROI: Typically 500-800% in the first 6 months.</p>
                    `;

                    summaryDiv.innerHTML = createSummaryCard('Your Custom Solution', summaryContent, 'fa-cogs', 'gray');
                    summaryDiv.innerHTML += createSummaryCard('Estimated Time Savings', timeSavingsContent, 'fa-clock', 'blue');
                    summaryDiv.innerHTML += createSummaryCard('Return on Investment', roiContent, 'fa-chart-line', 'green');
                    summaryDiv.innerHTML += createSummaryCard('Your Investment', pricingContent, 'fa-tags', 'purple');

                    calculatingDiv.style.display = 'none';
                    contentDiv.style.display = 'block';
                }, 2500);
            }

            function showBuilderModal(title, message, type = 'error') {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                if (type === 'success') {
                    modalIcon.innerHTML = `<i class="fas fa-check text-green-600 text-xl"></i>`;
                    modalIcon.className = 'mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4';
                } else if (type === 'loading') {
                     modalIcon.innerHTML = `<i class="fas fa-spinner spinner text-blue-600 text-xl"></i>`;
                    modalIcon.className = 'mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4';
                } else {
                    modalIcon.innerHTML = `<i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>`;
                    modalIcon.className = 'mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4';
                }
                modal.classList.add('active');
            }

            function closeBuilderModal() {
                modal.classList.remove('active');
            }

            // --- DEMO CHATBOT LOGIC ---
            let demoCurrentStep = 1;
            let demoUserData = {};

            function openDemoModal() {
                demoModal.classList.add('active');
                startDemoChat();
            }

            function closeDemoModal() {
                demoModal.classList.remove('active');
            }

            function startDemoChat() {
                demoCurrentStep = 1;
                demoUserData = {};
                const messagesContainer = document.getElementById('demo-messages');
                messagesContainer.innerHTML = ''; // Clear previous chat
                demoAddMessage(`Hi! I'm here to determine if we can assist with your legal matter. This will only take 2-3 minutes.<br><br>What type of legal issue brings you here today?
                    <div class="options" id="legal-type">
                        <div class="option-btn" onclick="demoSelectOption('Personal Injury')">Personal Injury</div>
                        <div class="option-btn" onclick="demoSelectOption('Family Law')">Family Law / Divorce</div>
                        <div class="option-btn" onclick="demoSelectOption('Criminal Defense')">Criminal Defense</div>
                        <div class="option-btn" onclick="demoSelectOption('Other')">Other Legal Matter</div>
                    </div>`);
            }

            window.demoAddMessage = function(text, isBot = true) {
                const messagesContainer = document.getElementById('demo-messages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isBot ? 'bot-message' : 'user-message'}`;
                
                if (isBot) {
                    messageDiv.innerHTML = `<div class="bot-avatar">⚖️</div><div class="bot-text">${text}</div>`;
                } else {
                    messageDiv.innerHTML = `<div class="user-text">${text}</div>`;
                }
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            function demoShowTyping() {
                const messagesContainer = document.getElementById('demo-messages');
                const typingDiv = document.createElement('div');
                typingDiv.className = 'typing-indicator';
                typingDiv.id = 'typing';
                typingDiv.innerHTML = `<div class="bot-avatar">⚖️</div><div class="typing-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
                messagesContainer.appendChild(typingDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            function demoHideTyping() {
                const typing = document.getElementById('typing');
                if (typing) typing.remove();
            }

            window.demoSelectOption = function(value) {
                document.querySelectorAll('.option-btn').forEach(btn => btn.style.display = 'none');
                demoAddMessage(value, false);
                demoUserData.legalType = value;
                
                setTimeout(() => {
                    demoShowTyping();
                    setTimeout(() => {
                        demoHideTyping();
                        demoNextStep();
                    }, 1500);
                }, 500);
            }

            function demoNextStep() {
                demoCurrentStep++;
                switch(demoCurrentStep) {
                    case 2:
                        demoAddMessage(`Great! I help with ${demoUserData.legalType.toLowerCase()} cases regularly. When did this incident/situation occur?
                            <div class="options">
                                <div class="option-btn" onclick="demoSelectOption('Within the last month')">Within the last month</div>
                                <div class="option-btn" onclick="demoSelectOption('1-6 months ago')">1-6 months ago</div>
                                <div class="option-btn" onclick="demoSelectOption('Over 6 months ago')">Over 6 months ago</div>
                            </div>`);
                        break;
                    case 3:
                        demoAddMessage(`Thank you. Have you spoken with any other attorneys about this matter?
                            <div class="options">
                                <div class="option-btn" onclick="demoSelectOption('No, you\\'re the first')">No, you're the first</div>
                                <div class="option-btn" onclick="demoSelectOption('Yes, but wasn\\'t satisfied')">Yes, but wasn't satisfied</div>
                                <div class="option-btn" onclick="demoSelectOption('Still exploring options')">Still exploring options</div>
                            </div>`);
                        break;
                    case 4:
                        demoAddMessage(`Perfect! Based on your situation, I believe we can definitely help.
                            <br><br><span class="highlight">We have extensive experience with ${demoUserData.legalType.toLowerCase()} cases and offer free consultations.</span>
                            <br><br>To secure your consultation slot and show you're serious about moving forward, we require a small $50 consultation deposit (fully refundable if we can't help).
                            <div class="payment-section">
                                <div class="payment-amount">Consultation Deposit: $50</div>
                                <p style="font-size: 0.9em; margin: 8px 0;">✓ Fully refundable if we can't help<br>✓ Applied to any future legal fees<br>✓ Secures priority scheduling</p>
                                <button class="stripe-btn" onclick="demoSimulatePayment()">🔒 Secure Payment via Stripe</button>
                            </div>
                            <div class="options" style="margin-top: 15px;"><div class="option-btn" onclick="demoSelectOption('I want to think about it')">I'd like to think about it</div></div>`);
                        break;
                    case 5:
                        demoAddMessage(`Excellent! Your payment has been processed securely.
                            <br><br><span class="highlight">Sarah from our office will call you within 2 hours to schedule your consultation.</span>
                            <br><br>Please keep an eye out for a call from (555) 123-4567.
                            <br><br>Thank you for choosing Smith & Associates!`);
                        break;
                }
            }

            window.demoSimulatePayment = function() {
                document.querySelector('.payment-section').innerHTML = '<div style="text-align: center; padding: 20px;"><div style="color: #28a745; font-size: 1.1em;">✓ Processing Payment...</div></div>';
                
                setTimeout(() => {
                    demoAddMessage('Payment Confirmed! ✓', false);
                    setTimeout(() => {
                        demoShowTyping();
                        setTimeout(() => {
                            demoHideTyping();
                            demoNextStep();
                        }, 1500);
                    }, 500);
                }, 2000);
            }

            // --- INITIALIZATION ---
            updateUI();
        });
    </script>
</body>
</html>
